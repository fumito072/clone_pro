# Google Cloud Speech-to-Text ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Google Cloud Speech-to-Text APIã‚’ä½¿ç”¨ã—ãŸéŸ³å£°èªè­˜ï¼ˆSTTï¼‰ã‚µãƒ¼ãƒãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ðŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ

```bash
cd ears_stt
chmod +x setup.sh
./setup.sh
```

### 2. Google Cloud èªè¨¼æƒ…å ±ã‚’å–å¾—

ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ï¼ˆJSONï¼‰ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚

## ðŸ“‹ Google Cloud è¨­å®šæ‰‹é †ï¼ˆè©³ç´°ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—1: Google Cloudãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

1. [Google Cloud Console](https://console.cloud.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. å·¦ä¸Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠžãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ï¼ˆä¾‹: `president-clone`ï¼‰
6. ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚¹ãƒ†ãƒƒãƒ—2: Speech-to-Text APIã®æœ‰åŠ¹åŒ–

1. å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ **ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€** â†’ **ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€**
2. æ¤œç´¢ãƒãƒ¼ã« `Cloud Speech-to-Text API` ã¨å…¥åŠ›
3. **ã€ŒCloud Speech-to-Text APIã€** ã‚’é¸æŠž
4. **ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€** ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

1. å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ **ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€** â†’ **ã€Œèªè¨¼æƒ…å ±ã€**
2. **ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€** â†’ **ã€Œã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€** ã‚’é¸æŠž
3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è©³ç´°ã‚’å…¥åŠ›:
   - **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå**: `stt-service-account` (ä»»æ„ã®åå‰)
   - **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID**: è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
   - **èª¬æ˜Ž**: `Speech-to-Text APIç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ` (ä»»æ„)
4. **ã€Œä½œæˆã—ã¦ç¶šè¡Œã€** ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ­ãƒ¼ãƒ«ã®å‰²ã‚Šå½“ã¦

1. **ã€Œã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã€** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§:
   - **ã€Œãƒ­ãƒ¼ãƒ«ã‚’é¸æŠžã€** â†’ **ã€ŒCloud Speechã€** â†’ **ã€ŒCloud Speech ç®¡ç†è€…ã€** ã‚’é¸æŠž
2. **ã€Œç¶šè¡Œã€** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ã€Œå®Œäº†ã€** ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚¹ãƒ†ãƒƒãƒ—5: JSONã‚­ãƒ¼ã®ä½œæˆ

1. **ã€Œèªè¨¼æƒ…å ±ã€** ãƒšãƒ¼ã‚¸ã§ã€ä½œæˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯
2. **ã€Œã‚­ãƒ¼ã€** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ã€Œéµã‚’è¿½åŠ ã€** â†’ **ã€Œæ–°ã—ã„éµã‚’ä½œæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **ã€ŒJSONã€** ã‚’é¸æŠž
5. **ã€Œä½œæˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯
6. JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•çš„ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™

### ã‚¹ãƒ†ãƒƒãƒ—6: èªè¨¼æƒ…å ±ã®é…ç½®

1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’ `google_credentials.json` ã«å¤‰æ›´
2. ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `ears_stt/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®

```bash
# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç§»å‹•ã™ã‚‹ä¾‹
mv ~/Downloads/project-name-xxxxx.json /path/to/PresidentClone/ears_stt/google_credentials.json
```

## ðŸŽ¯ ä½¿ç”¨æ–¹æ³•

### ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
cd ears_stt
python run_stt_server.py
```

èµ·å‹•ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™:

```
ðŸš€ Google Cloud Speech-to-Text ã‚¨ãƒ³ã‚¸ãƒ³ã‚’åˆæœŸåŒ–ä¸­...
âœ… åˆæœŸåŒ–å®Œäº†
ðŸ”Œ WebSocketã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸ: ws://0.0.0.0:8001/listen
ðŸŽ¤ ãƒžã‚¤ã‚¯å…¥åŠ›ã‚’é–‹å§‹ã—ã¾ã—ãŸ
ðŸŽ¤ éŸ³å£°ã‚’å¾…æ©Ÿä¸­... (è©±ã—ã‹ã‘ã¦ãã ã•ã„ã€‚Ctrl+Cã§åœæ­¢)
```

### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã®æŽ¥ç¶š

`controller.py` ãŒè‡ªå‹•çš„ã«ã“ã®ã‚µãƒ¼ãƒãƒ¼ã«æŽ¥ç¶šã—ã¾ã™:

```python
EARS_STT_SERVER_URL = "ws://127.0.0.1:8001/listen"
```

## ðŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

```
âš ï¸ Google Cloudèªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
```

- `google_credentials.json` ãŒ `ears_stt/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒ•ã‚¡ã‚¤ãƒ«åãŒæ­£ç¢ºã« `google_credentials.json` ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ©ãƒ¼

```
google.api_core.exceptions.PermissionDenied: 403 Cloud Speech-to-Text API has not been used...
```

- Google Cloud Consoleã§Speech-to-Text APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- æ•°åˆ†å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œï¼ˆAPIã®æœ‰åŠ¹åŒ–ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰

### ãƒžã‚¤ã‚¯ãŒèªè­˜ã•ã‚Œãªã„

```
âŒ [Audio] PyAudioã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ
```

- macOSã®å ´åˆ: **ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒè¨­å®š** â†’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼** â†’ **ãƒžã‚¤ã‚¯** ã§ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¾ãŸã¯Pythonã«ãƒžã‚¤ã‚¯ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ä»˜ä¸Ž
- ãƒžã‚¤ã‚¯ãŒæ­£ã—ãæŽ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼

```bash
# PyAudioã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã™ã‚‹å ´åˆï¼ˆmacOSï¼‰
brew install portaudio
pip install pyaudio
```

## ðŸ”§ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã®ä¸€èˆ¬çš„ãªå•é¡Œã¨å¯¾å‡¦æ³•

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã«ç›´é¢ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ä¸€èˆ¬çš„ãªå•é¡Œã¨å¯¾å‡¦æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚ç‰¹ã«macOSç’°å¢ƒã§åˆã‚ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

### 1. `gcloud` ã‚³ãƒžãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼:**
```
zsh: command not found: gcloud
```

**åŽŸå› :** Google Cloud CLIãŒã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯PATHãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**å¯¾å‡¦æ³•:**
```bash
# Google Cloud CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install google-cloud-sdk
```

### 2. `ctranslate2` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¤±æ•—

**ã‚¨ãƒ©ãƒ¼:**
```
ERROR: No matching distribution found for ctranslate2==4.6.0
```

**åŽŸå› :** è¦æ±‚ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ (4.6.0) ãŒã€ä½¿ç”¨ã—ã¦ã„ã‚‹Pythonã‚„OSã®ç’°å¢ƒã§åˆ©ç”¨ã§ãã‚‹ãƒã‚¤ãƒŠãƒªã¨ã—ã¦PyPIã«å­˜åœ¨ã—ãªã„

**å¯¾å‡¦æ³•:**
- åˆ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è©¦ã™ã€ã¾ãŸã¯ requirements.txt ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª¿æ•´ã™ã‚‹

### 3. `numba` ã®ãƒ“ãƒ«ãƒ‰å¤±æ•—

**ã‚¨ãƒ©ãƒ¼:**
```
RuntimeError: Cannot install on Python version 3.14.0; only versions >=3.10,<3.14 are supported.
```

**åŽŸå› :** ä½¿ç”¨ã—ã¦ã„ã‚‹Python 3.14ãŒ `numba` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚µãƒãƒ¼ãƒˆå¯¾è±¡å¤–

**å¯¾å‡¦æ³•:**
- Python 3.12 ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’å¼·ãæŽ¨å¥¨ã—ã¾ã™
```bash
# Python 3.12ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
pyenv install 3.12.0
pyenv local 3.12.0
```

### 4. `PyAudio` ã®ãƒ“ãƒ«ãƒ‰å¤±æ•— - PortAudio ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼:**
```
fatal error: 'portaudio.h' file not found
```

**åŽŸå› :** PyAudioã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«å¿…è¦ãªã‚·ã‚¹ãƒ†ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆPortAudioï¼‰ã®ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**å¯¾å‡¦æ³•:**
```bash
# Homebrewã§ PortAudio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSï¼‰
brew install portaudio

# ãã®å¾Œã€å†åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install pyaudio
```

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã®é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

- **æŽ¨å¥¨Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³:** Python 3.12 ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
- **ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ (macOS):** `pip install -r requirements.txt` ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€å¿…ãš PortAudio ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§:** å°†æ¥çš„ã«Python 3.15ãªã©ãŒå‡ºãŸå ´åˆã€äº’æ›æ€§ã®ã‚ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ3.12ãªã©ï¼‰ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦è§£æ±ºã—ã¦ãã ã•ã„

## ðŸ’° æ–™é‡‘ã«ã¤ã„ã¦

Google Cloud Speech-to-Text APIã¯å¾“é‡èª²é‡‘åˆ¶ã§ã™:

- **ç„¡æ–™æž **: æœˆ60åˆ†ã¾ã§ç„¡æ–™
- **è¶…éŽåˆ†**: 15ç§’å˜ä½ã§èª²é‡‘

è©³ç´°ã¯[å…¬å¼æ–™é‡‘ãƒšãƒ¼ã‚¸](https://cloud.google.com/speech-to-text/pricing)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ðŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- `google_credentials.json` ã¯æ©Ÿå¯†æƒ…å ±ã§ã™
- ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«è¿½åŠ æ¸ˆã¿ãªã®ã§ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“
- **çµ¶å¯¾ã«å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„ã§ãã ã•ã„**

## ðŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Google Cloud Speech-to-Text ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/speech-to-text/docs)
- [Python ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://cloud.google.com/speech-to-text/docs/libraries#client-libraries-install-python)
- [ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°èªè­˜ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://cloud.google.com/speech-to-text/docs/streaming-recognize)

## âœ… å‹•ä½œç¢ºèª

æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹å ´åˆ:

1. ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¨ã€ãƒžã‚¤ã‚¯ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™
2. è©±ã—ã‹ã‘ã‚‹ã¨ã€éŸ³å£°ãŒèªè­˜ã•ã‚Œã¾ã™
3. èªè­˜çµæžœãŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã™
4. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒLLMã‚µãƒ¼ãƒãƒ¼ã«è»¢é€ã—ã¾ã™
5. LLMã‹ã‚‰ã®å¿œç­”ãŒTTSã§å†ç”Ÿã•ã‚Œã¾ã™

---

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
